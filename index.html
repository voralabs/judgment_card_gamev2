<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Card Game</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }
    .suit-icon {
      font-size: 20px;
    }
    .btn-small {
      font-size: 10px;
      padding: 2px 4px;
      margin: 0 1px;
      cursor: pointer;
    }
    .btn-green {
      background-color: #4CAF50;
      color: white;
    }
    .btn-red {
      background-color: #f44336;
      color: white;
    }
    .btn-faded {
      background-color: #ccc !important;
      color: #666 !important;
      cursor: default !important;
    }
    .locked input {
      background-color: #eee;
      border: none;
    }
    .win {
      background-color: #d4edda;
    }
    .loss {
      background-color: #f8d7da;
    }
  </style>
</head>
<body>
  <h2>Card Game Setup</h2>
  <label>Number of Players: <input type="number" id="numPlayers" min="2" /></label>
  <button onclick="setupPlayers()">Next</button>
  <div id="playerNames"></div>
  <div id="gameArea"></div>
  <button onclick="addMoreGames()">Add More Games</button>
  <script>
    const suits = ['Spade', 'Diamond', 'Club', 'Heart', 'None'];
    const suitIcons = {
      Spade: '‚ô†Ô∏è',
      Diamond: '‚ô¶Ô∏è',
      Club: '‚ô£Ô∏è',
      Heart: '‚ô•Ô∏è',
      None: 'üÉè'
    };
    let maxCards = 0;
    let numPlayers = 0;
    let players = [];
    let suitSequence = [];
    let cardSequence = [];
    let scores = {};
    let roundScores = {};
    let gameRounds = 10;

    function normalizeName(name) {
      return name.trim().replace(/\s+/g, '_');
    }

    function setupPlayers() {
      numPlayers = parseInt(document.getElementById('numPlayers').value);
      if (isNaN(numPlayers) || numPlayers < 2) return alert('Enter valid number of players');

      document.getElementById('playerNames').innerHTML = '';
      const div = document.createElement('div');
      div.innerHTML = '<h3>Enter Player Names:</h3>';
      for (let i = 0; i < numPlayers; i++) {
        div.innerHTML += `<label>Player ${i + 1}: <input type="text" id="p${i}" /></label><br/>`;
      }
      div.innerHTML += '<button onclick="startGame()">Start Game</button>';
      document.getElementById('playerNames').appendChild(div);
    }

    function calculateMaxCards() {
      return Math.floor(52 / numPlayers);
    }

    function generateCardSequence(rows) {
      let down = true;
      let n = maxCards;
      const sequence = [];
      while (sequence.length < rows) {
        sequence.push(n);
        if (down) {
          n--;
          if (n < 0) {
            n = 1;
            down = false;
          }
        } else {
          n++;
          if (n > maxCards) down = true;
        }
      }
      return sequence;
    }

    function startGame() {
      players = [];
      scores = {};
      roundScores = {};
      for (let i = 0; i < numPlayers; i++) {
        const name = document.getElementById(`p${i}`).value.trim();
        if (!name) return alert('All names are required');
        const cleanName = normalizeName(name);
        players.push(cleanName);
        scores[cleanName] = 0;
        roundScores[cleanName] = [];
      }
      maxCards = calculateMaxCards();
      renderGameGrid();
    }

    function renderGameGrid() {
      const grid = document.createElement('table');
      grid.id = 'gameGrid';
      const header = document.createElement('tr');
      ['Suit', 'Game Suit', 'Cards', ...players, 'Action'].forEach(h => {
        const th = document.createElement('th');
        th.textContent = h;
        header.appendChild(th);
      });
      grid.appendChild(header);

      suitSequence = Array.from({ length: gameRounds }, (_, i) => suits[i % 5]);
      cardSequence = generateCardSequence(gameRounds);

      suitSequence.forEach((suit, row) => {
        appendGameRow(grid, suit, row);
      });

      document.getElementById('gameArea').innerHTML = '';
      document.getElementById('gameArea').appendChild(grid);

      const scoreTable = document.createElement('table');
      scoreTable.id = 'scoreSummary';

      const headerRow = document.createElement('tr');
      const headerCell = document.createElement('th');
      headerCell.textContent = 'Round / Player';
      headerRow.appendChild(headerCell);
      players.forEach(p => {
        const th = document.createElement('th');
        th.textContent = p;
        headerRow.appendChild(th);
      });
      scoreTable.appendChild(headerRow);

      document.getElementById('gameArea').appendChild(scoreTable);
    }

    function appendGameRow(grid, suit, rowIndex) {
      const tr = document.createElement('tr');
      const iconTd = document.createElement('td');
      iconTd.innerHTML = `<span class="suit-icon">${suitIcons[suit]}</span>`;
      tr.appendChild(iconTd);

      const suitTd = document.createElement('td');
      suitTd.textContent = suit;
      tr.appendChild(suitTd);

      const cardTd = document.createElement('td');
      cardTd.textContent = cardSequence[rowIndex];
      cardTd.classList.add('card-count');
      tr.appendChild(cardTd);

      players.forEach(player => {
        const td = document.createElement('td');
        td.innerHTML = `<input type='number' min='0' style='width: 40px;' data-player='${player}' data-row='${rowIndex}' />`;
        tr.appendChild(td);
      });

      const lockTd = document.createElement('td');
      const lockBtn = document.createElement('button');
      lockBtn.textContent = 'Lock In';
      lockBtn.onclick = () => lockRow(tr, rowIndex);
      lockTd.appendChild(lockBtn);
      tr.appendChild(lockTd);

      grid.appendChild(tr);
    }

    function addMoreGames() {
      const table = document.getElementById('gameGrid');
      const newRounds = 5;
      const currentRounds = table.rows.length - 1;
      const newSuitSequence = Array.from({ length: newRounds }, (_, i) => suits[(i + currentRounds) % 5]);
      const newCardSequence = generateCardSequence(currentRounds + newRounds).slice(currentRounds);

      newSuitSequence.forEach((suit, i) => {
        suitSequence.push(suit);
        cardSequence.push(newCardSequence[i]);
        appendGameRow(table, suit, currentRounds + i);
      });

      gameRounds += newRounds;
    }

    // lockRow and updateScoreSummary functions stay unchanged
  </script>
</body>
</html>
